<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
	<head th:insert="fragments/head-common :: head-metadados"></head>
	<body>
	    <!-- ============================================================== -->
	    <!-- Preloader - style you can find in spinners.css -->
	    <!-- ============================================================== -->
	    <div th:insert="fragments/pre-loader-common :: pre-loader"></div>
	    <!-- ============================================================== -->
	    <!-- End Preloader - style you can find in spinners.css -->
	    <!-- ============================================================== -->
	    <!-- ============================================================== -->
	    <!-- Main wrapper - style you can find in pages.scss -->
	    <!-- ============================================================== -->
	    <div id="main-wrapper">
	        <!-- ============================================================== -->
	        <!-- Topbar header - style you can find in pages.scss -->
	        <!-- ============================================================== -->
	        <header class="topbar">
	            <div th:insert="fragments/header-common :: header-common"></div>
	        </header>
	        <!-- ============================================================== -->
	        <!-- End Topbar header -->
	        <!-- ============================================================== -->
	        <!-- ============================================================== -->
	        <!-- Left Sidebar - style you can find in sidebar.scss  -->
	        <!-- ============================================================== -->
	        <aside class="left-sidebar" th:insert="fragments/left-sidebar-common :: left-sidebar"></aside>
	        <!-- ============================================================== -->
	        <!-- End Left Sidebar - style you can find in sidebar.scss  -->
	        <!-- ============================================================== -->
	        <div th:insert="fragments/loading-page :: data-loading"></div>
	        <!-- ============================================================== -->
	        <!-- Page wrapper  -->
	        <!-- ============================================================== -->
	        <div class="page-wrapper">
	            <!-- ============================================================== -->
	            <!-- Container fluid  -->
	            <!-- ============================================================== -->
	            <div class="container-fluid" style="padding: 5px;">
	                <!-- ============================================================== -->
	                <!-- Start Page Content -->
	                <!-- ============================================================== -->
	            
	                <!-- ============================================================== -->
	                <!-- End PAge Content -->
	                <!-- ============================================================== -->
	                <!-- ============================================================== -->
	                <!-- Right sidebar -->
	                <!-- ============================================================== -->
	                <!-- .right-sidebar -->
	                <!-- ============================================================== -->
	                <!-- End Right sidebar -->
	                <!-- ============================================================== -->
	            </div>
	            <!-- ============================================================== -->
	            <!-- End Container fluid  -->
	            <!-- ============================================================== -->
	            <!-- ============================================================== -->
	            <!-- footer -->
	            <!-- ============================================================== -->
	            <footer class="footer footer-common" th:insert="fragments/footer-common :: footer"></footer>
	            <!-- ============================================================== -->
	            <!-- End footer -->
	            <!-- ============================================================== -->
	        </div>
	        <!-- ============================================================== -->
	        <!-- End Page wrapper  -->
	        <!-- ============================================================== -->
	    </div>
	    <!-- ============================================================== -->
	    <!-- End Wrapper -->
	    <!-- ============================================================== -->
	    <!-- ============================================================== -->
	    <!-- customizer Panel -->
	    <!-- ============================================================== -->
	    <div class="chat-windows"></div>
	    <!-- ============================================================== -->
	    <!--<form id="formDashboard" name="formDashboard" th:action="@{/dashboard/pendingItens}" method="post" autocomplete="off">		
		</form>-->
		<div th:insert="fragments/scripts-common :: scripts-common"></div>
		<link th:href="@{/assets/libs/datatables.net-bs4/css/dataTables.bootstrap4.css}" rel="stylesheet">
	    <link th:href="@{/assets/libs/datatables/novo/css/responsive.bootstrap4.min.css}" rel="stylesheet" type="text/css" >
	    <link th:href="@{/assets/libs/datatables/novo/css/buttons.dataTables.min.css}" rel="stylesheet" type="text/css">
	    
	    <style>
	    	table.dataTable tbody th, table.dataTable tbody td {
			    padding: 8px 4px; /* e.g. change 8x to 4px here */
			}
	    </style>
	    <!-- SweetAlert -->   	
    	<link th:href="@{/assets/libs/sweetalert2/dist/sweetalert2.min.css}" rel="stylesheet"/>
    	<script th:src="@{/assets/libs/sweetalert2/dist/sweetalert2.all.min.js}"></script>
		<!-- data-table js -->
		<script th:src="@{/assets/libs/datatables/novo/js/jquery.dataTables.min.js}"></script>
		<script th:src="@{/assets/libs/datatables/novo/js/dataTables.buttons.min.js}"></script>
		<script th:src="@{/assets/libs/datatables/novo/js/jszip.min.js}"></script>
		<script th:src="@{/assets/libs/datatables/novo/js/pdfmake.min.js}"></script>
		<script th:src="@{/assets/libs/datatables/novo/js/vfs_fonts.js}"></script>
		<script th:src="@{/assets/libs/datatables/novo/js/buttons.flash.min.js}"></script>
		<script th:src="@{/assets/libs/datatables/novo/js/buttons.colVis.min.js}"></script>
		<script th:src="@{/assets/libs/datatables/novo/js/buttons.print.min.js}"></script>
		<script th:src="@{/assets/libs/datatables/novo/js/buttons.html5.min.js}"></script>
		<script th:src="@{/assets/libs/datatables/novo/js/dataTables.bootstrap4.min.js}"></script>
		<script th:src="@{/assets/libs/datatables/novo/js/dataTables.responsive.min.js}"></script>
	    <script th:src="@{/assets/libs/datatables/novo/js/responsive.bootstrap4.min.js}"></script>
		<script type="text/javascript">
	    function createTablesDashboard()
	    {
	        $('table#table-pending-itens').DataTable({
		            destroy: true,
				        select:'single',
				        'paging': false,
					   	'displayLength': 700,
			   		 	'responsive': true,
					   	'order': [ [ 0, 'asc' ] ],
					   	'autoWidth': false,
						'scrollCollapse': true,
						'scrollY': 200,
				        'scrollX': true,
						'language': {
					           'lengthMenu': 'Mostrar _MENU_ registro(s) por pagina',
					           'zeroRecords': 'Nenhum registro encontrado',
					           'info': 'Mostrando _TOTAL_ registro(s)',
					           'infoEmpty': 'Nenhum registro encontrado',
					           'infoFiltered': '(filtrado de um total de _MAX_ registros)',
					           'search': 'Filtrar:',
					           'sLengthMenu': '_MENU_ &nbsp;registro(s) por p&aacute;gina',
					           "decimal": ",",
					           "thousands": ".",
					           'paginate': {
					               'next': 'Proximo',
					               'previous': 'Anterior'
					             }
					    },
						dom: 'Bfrtip',
						buttons: [
						{
							extend: 'copyHtml5',
							text: 'Copiar',
							exportOptions: {
								columns: ':visible'
							}
						}, 
						{
							extend: 'excelHtml5',
							text: 'Excel',
							title: 'Relatorio',
							exportOptions: {
								columns: ':visible'
							}
						}, 
						{
							extend: 'pdfHtml5',
							text: 'PDF',
							title: 'Relatorio',
							orientation: 'landscape',
							pageSize: 'A4',
							pageMargins: [ 0, 0, 0, 0 ], // try #1 setting margins
							margin: [ 0, 0, 0, 0 ], // try #2 setting margins
							key: { // press E for export PDF
								key: 'e',
								altKey: true
							},
							exportOptions: {
								columns: ':visible'
							}
						}, 
						{
							text: 'JSON',
							action: function(e, dt, button, config) 
							{
								var data = dt.buttons.exportData();
								$.fn.dataTable.fileSave(new Blob([JSON.stringify(data)]), 'Relatorio.json');
							}
						},
						'colvis']
		        });
		        $('.buttons-copy, .buttons-csv, .buttons-print, .buttons-pdf, .buttons-excel, .dt-button').addClass('btn btn-primary mr-1');
		    }
	    
			function processDashboard()
			{
		  		showLoading("Carregando dados dashboard... Por favor aguarde...");  
		  		
		  		var countSystemOld = 0;
		  		var percentSystemOldOnline = 0;
		  		var percentSystemOldOffline = 0;
		  		var widthSystemOldOnline = 0;
		  		var widthSystemOldOffline = 0;		  		
		  		var countSystem = 0;
		  		var percentSystemOnline = 0;
		  		var percentSystemOffline = 0;
		  		var widthSystemOnline = 0;
		  		var widthSystemOffline = 0;
		  		
		  		$('div#table-pending-itens').html('');
		  		
        		var trHTML = '<table id="table-pending-itens" class="table table-striped table-bordered display dataTable">';
        		trHTML += '<thead>';
        		trHTML += '<tr class="bg-light">';
        		trHTML += '<th class="border-top-0 text-center">Sistema</th>';
        		trHTML += '<th class="border-top-0 text-center">Empresa</th>';
        		trHTML += '<th class="border-top-0 text-center">Data Movimento</th>';
        		trHTML += '<th class="border-top-0 text-center">Online</th>';
        		trHTML += '<th class="border-top-0 text-center">Qtde Produtos</th>';
        		trHTML += '</tr>';
        		trHTML += '</thead>';
        		trHTML += '<tbody>';                    
	
		  		var form = $('form#formDashboard'); 
		  		$.ajax({
		            url : form.attr('action'),
		            type : "POST",
		            dataType : "json"
		    	})
		    	.done(function(data, textStatus, jqXHR) 
		    	{	    		
	            	if(true==data.status)
	             	{
	            		$.each(data.report, function(key, value)
	            	   	{
	            			countSystem +=1;
	            			
	            			trHTML += '<tr>';
	            			trHTML += '<td class="text-center">Novo</td>';
	            			trHTML += '<td class="text-center">'+value.customer+'</td>';
	            			trHTML += '<td class="text-center">'+value.movementDate+'</td>';
	                		if(value.online)
	                		{
	                			percentSystemOnline+=1;
	                			trHTML += '<td class="text-center">Sim</td>';
	                		}
	                		else
	                		{
	                			percentSystemOffline+=1;
	                			trHTML += '<td class="text-center">N&atilde;o</td>';
	                		}
	                		trHTML += '<td class="text-center">'+value.countProducts+'</td>';
	            			trHTML += '</tr>';
	            	   	});
	            		$.each(data.reportOld, function(key, value)
   	            	   	{
	            			countSystemOld+=1;
   	            			trHTML += '<tr>';
   	            			trHTML += '<td class="text-center">Antigo</td>';
   	            			trHTML += '<td class="text-center">'+value.customer+'</td>';
   	            			trHTML += '<td class="text-center">'+value.movementDate+'</td>';
   	                		if(value.online)
   	                		{
   	                			percentSystemOldOnline+=1;
   	                			trHTML += '<td class="text-center">Sim</td>';
   	                		}
   	                		else
   	                		{
   	                			percentSystemOldOffline+=1;
   	                			trHTML += '<td class="text-center">N&atilde;o</td>';
   	                		}
   	                		trHTML += '<td class="text-center">'+value.countProducts+'</td>';
   	            			trHTML += '</tr>';
   	            	   	});
	             	}
	             	else
	             	{
	            		hideLoading();
	        	    	showSweetalertWarning('Alerta!', data.message,'30000');
	             	}
		    	})
		    	.fail(function() 
		      	{
		    		showSweetalertWarning('Alerta!', 'Ocorreu um erro ao buscar dados dashboard.','30000');
			    }).always(function() 
			    {
	        		trHTML += '<tbody>';
	    			trHTML += '</table>';
	    			$('div#table-pending-itens').html(trHTML);
	    			
	    			createTablesDashboard();
	    			
			  		widthSystemOldOnline = ((percentSystemOldOnline*100) / countSystemOld);
			  		widthSystemOldOffline = ((percentSystemOldOffline*100) / countSystemOld);		  		

			  		widthSystemOnline = ((percentSystemOnline*100) / countSystem);
			  		widthSystemOffline = ((percentSystemOffline*100) / countSystem);	

	    			$('span#spnTotalSystemOld').text(countSystemOld);
	    			$('span#spnTotalSystemNew').text(countSystem);
	    			
	    			$('div#prgOnlineSystemOld').css("width", Math.round(widthSystemOldOnline)+"%");
	    			$('div#prgOfflineSystemOld').css("width", Math.round(widthSystemOldOffline)+"%");
	    			
	    			$('div#prgOnlineSystem').css("width", Math.round(widthSystemOnline)+"%");
	    			$('div#prgOfflineSystem').css("width", Math.round(widthSystemOffline)+"%");
	    			
	    			$('#hOnlineSystemOld').text(percentSystemOldOnline);
	    			$('#hOfflineSystemOld').text(percentSystemOldOffline);

	    			$('#hOnlineSystemNew').text(percentSystemOnline);
	    			$('#hOfflineSystemNew').text(percentSystemOffline);
	    				    			
		      		$('#block1').hide();
		    		$('#block2').hide();
			    });
			}
			
			(function() 
			{
				'use strict';
				//processDashboard();
			})();
			
		</script>
	</body>
</html>