<html>
	<head>
		<meta charset="utf-8">
	    <meta http-equiv="X-UA-Compatible" content="IE=edge">
	    <!-- Tell the browser to be responsive to screen width -->
	    <meta name="viewport" content="width=device-width, initial-scale=1">
	    <meta name="description" content="">
	    <meta name="author" content="">
	    <!-- Favicon icon -->
	    <link rel="icon" type="image/png" sizes="16x16" href="../../assets/images/favicon.png">
	    <title>Manager Systems</title>
	    <!-- Custom CSS -->
	    <link href="../../dist/css/style.min.css" rel="stylesheet">
	    <link href="../../dist/css/application-style.css" rel="stylesheet">
	    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
	    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
	    <!--[if lt IE 9]>
		    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
		    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
		<![endif]-->	
	</head>
	<!--<th:block th:fragment="content">-->
	<body> 
		<div class="col-md-12">
			<div class="card">
	            <div class="card-body" style="padding: 5px;">
	                   <h4 class="p-20 text-center">Extrato de Contas</h4>    
	                <div class="col-md-12">
	                    <div style="float: right;">
	                        <a id="btnFilter" name="btnFilter" type="button" class="btn waves-effect waves-light btn-success m-t-10 dropdown-toggle" data-toggle="collapse" data-target="#collapseFilter" aria-expanded="false" aria-controls="collapseFilter"><i class="ti-filter" style="font-size: 14px;"></i></a>
							<a id="btnView" href="javascript: searchDocuments();" name="btnView" type="button" class="btn waves-effect waves-light btn-outline-success m-t-10">Visualizar</a>
							<a id="btnPrint" href="javascript: printDocuments();" name="btnPrint" type="button" class="btn waves-effect waves-light btn-outline-info m-t-10"><i class="mdi mdi-printer"></i>&nbsp;Imprimir</a>
	                </div>
	                <!-- Nav tabs -->
	                <ul class="nav nav-tabs" role="tablist" style="margin-top: 60px;">
	                    <li class="nav-item"> <a class="nav-link active" data-toggle="tab" id="tabReport" href="#report" role="tab"><span class="hidden-sm-up"><i class="fas fa-list"></i></span> <span class="hidden-xs-down">Relat&oacute;rio</span></a> </li>
	                </ul>
	                <!-- Tab panes -->
	                <div class="tab-content tabcontent-border">
	                    <div class="tab-pane active" id="report" role="tabpanel">
	                        <div class="row">
	                            <div class="col-md-12">
	                                <!-- Filter -->
	                                <div class="collapse" id="collapseFilter">
	                                <!-- Filter Form -->
	                                    <form id="formFilter" name="formFilter" action="http://localhost:8080/ROOT/movement/bankAccountStatement/reportPdf" method="post" autocomplete="off" target="_blank">
	                                        <!-- Card -->
	                                        <div class="card">
	                                            <!-- Card Body -->
	                                            <div class="card-body">
	                                                <!-- Row Title Filter -->
	                                                <div class="row">
	                                                    <div class="col-md-12">
	                                                        <h4 class="card-title text-center font-weight-bold" style="margin-bottom: 20px;">Filtros de pesquisa</h4>
	                                                    </div>
	                                                </div>
	                                                <!--/ Row Title Filter -->
	                                                <!-- Row Fields Filter -->					
	                                                <div class="row">
														<div class="col-md-3 mb-3">
	                                                        <label for="filterData">Data</label>
	                                                        <div class="input-group">
	                                                            <input type="text" class="form-control timeseconds text-center" id="date" name="date" />
	                                                            <div class="input-group-append">
	                                                                <span class="input-group-text">
	                                                                    <span class="ti-calendar"></span>
	                                                                </span>
	                                                            </div>
	                                                        </div>
														</div>
														<div class="col-md-2 mb-3">
	                                                        <label for="operation">Tipo de Relat&oacute;rio</label>
	                                                        <select class="m-b-20 m-r-10 custom-select" id="operation" name="operation">
	                                                            <option value="1" selected>Anal&iacute;tico</option>
	                                                            <option value="2">Sint&eacute;tico</option>
	                                                            <option value="3">Por Conta</option>
	                                                        </select>
	                                                    </div>
	                                                    <div class="col-md-7 mb-3">
	                                                        <label for="company">Empresa</label>
	                                                        <select class="m-b-20 m-r-10 custom-select" id="company" name="company" multiple>	
																<option value="51">MAURO ST (51)</option>
	                                                            <option value="77">EDMAR1 (77)</option>
	                                                            <option value="53">JORGE STA (53)</option>
															</select>
	                                                    </div>
	                                                    <div class="col-md-12 mb-3">
	                                                        <label for="bankAccounts">Contas Banc&aacute;ria</label>
	                                                        <select class="m-b-20 m-r-10 custom-select" id="bankAccounts" name="bankAccounts" multiple>
																<!--
																<option value="50" selected>MAURO ST (50)</option>
	                                                            <option value="76" selected>EDMAR1 (76)</option>
																<option value="52" selected>JORGE STA (52)</option>
																-->
	                                                        </select>
														</div>
	                                                </div>													
	                                                <!--/ Row Fields Filtro -->
	                                            </div>
	                                            <!--/ Card Body -->
	                                        </div>
	                                        <!--/ Card -->
	                                    </form>
	                                    <!--/ Form Filter -->
	                                </div>
	                                <!--/ Filter -->    
	                            </div>
	                        </div>
	                        <div class="row">
								<div class="col-md-12">
									<div class="card card-hover">
										<div class="card-body">
											<div class="d-md-flex align-items-center">
												<div>
													<h4 class="card-title">Extrato dos Lan&ccedil;amentos</h4>
												</div>
											</div>
											<!-- column -->
											<div class="row m-t-40">
												<!-- Column -->
												<div class="col-md-3">
													<div class="card">
														<div class="card-body">
															<div class="d-flex flex-row">
																<div class="round round-lg align-self-center round-primary"><i class="mdi mdi mdi-currency-usd"></i></div>
																<div class="m-l-10 align-self-center">
																	<h3 class="m-b-0 font-lgiht" id="totalInitial">R$ 0.00</h3>
																	<h5 class="text-muted m-b-0">&nbsp;Inicial</h5></div>
															</div>
														</div>
													</div>
												</div>
												<!-- Column -->
												<!-- Column -->
												<div class="col-md-3">
													<div class="card">
														<div class="card-body">
															<div class="d-flex flex-row">
																<div class="round round-lg align-self-center round-primary"><i class="mdi mdi-plus"></i></div>
																<div class="m-l-10 align-self-center">
																	<h3 class="m-b-0 font-lgiht" id="totalCredit"></h3>
																	<h5 class="text-muted m-b-0">&nbsp;Cr&eacute;dito</h5></div>
															</div>
														</div>
													</div>
												</div>
												<!-- Column -->
												<!-- Column -->
												<div class="col-md-3">
													<div class="card">
														<div class="card-body">
															<div class="d-flex flex-row">
																<div class="round round-lg align-self-center round-warning"><i class="mdi mdi-minus"></i></div>
																<div class="m-l-10 align-self-center">
																	<h3 class="m-b-0 font-lgiht" id="totalDebit"></h3>
																	<h5 class="text-muted m-b-0">&nbsp;D&eacute;bito</h5></div>
															</div>
														</div>
													</div>
												</div>
												<!-- Column -->
												<!-- Column -->
												<div class="col-md-3">
													<div class="card">
														<div class="card-body">
															<div class="d-flex flex-row">
																<div class="round round-lg align-self-center round-success"><i class="mdi mdi-bank"></i></div>
																<div class="m-l-10 align-self-center">
																	<h3 class="m-b-0 font-lgiht" id="totalSaldo"></h3>
																	<h5 class="text-muted m-b-0">&nbsp;Saldo</h5></div>
															</div>
														</div>
													</div>
												</div>
												<!-- Column -->
											</div>
											<div class="row m-t-40">
												<div class="col-md-12">
													<div id="report-table" class="table-responsive">
														<table id="table-relatorio" style="width: 100%;" class="table table-striped table-bordered display">
															<thead>
																<tr>
																	<th class="text-center">Data</th>
																	<th class="text-center">Conta Banc&aacute;ria</th>
																	<th class="text-center">Empresa</th>
																	<th class="text-center">Descri&ccedil;&atilde;o</th>
																	<th class="text-center">Lan&ccedil;.</th>
																	<th class="text-center">Valor Hidden</th>
																	<th class="text-center">Agrupamento</th>
																	<th class="text-center">Documento</th>
																	<th class="text-center">Saldo</th>
																</tr>
															</thead>
															<tbody>
															</tbody>
														</table>									
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
							<div class="row">
								<div class="col-md-12">
									<div class="card card-hover">
										<div class="card-body">
											<div class="d-md-flex align-items-center">
												<div>
													<h4 class="card-title">Extrato das Empresas</h4>
												</div>
											</div>
											<div class="row m-t-40">
												<div class="col-md-12">
													<div id="report-table-company" class="table-responsive">
														<table id="table-company" style="width: 100%;" class="table table-striped table-bordered display">
															<thead>
																<tr>
																	<th class="text-center">Empresa</th>
																	<th class="text-center">Crédito</th>
																	<th class="text-center">Débito</th>
																	<th class="text-center">Saldo</th>											
																</tr>
															</thead>
															<tbody>
															</tbody>
														</table>									
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
	                        </div>
	                    </div>
	                </div>
	            </div>
	        </div>
		</div>
	</div>
		<form id="formFilterReportView" name="formFilterReportView" action="http://localhost:8080/ROOT/movement/bankAccountStatement/filter" method="post" autocomplete="off">
		</form>
		<form id="formGetBankAccounts" name="formGetBankAccounts" action="http://localhost:8080/ROOT/adm/bank-account/getAllComoboboxByPerson" method="post" autocomplete="off">
			<input type="hidden" id="inactive" name="inactive" value="0"/>
			<input type="hidden" id="personsId" name="personsId"/>
			<input type="hidden" id="objectType" name="objectType" value="COM"/>
		</form>
	<!--</th:block>-->
	<!-- All Jquery -->
		<!-- ============================================================== -->
		<!-- scripts-common -->
	    <script src="../../assets/libs/jquery/dist/jquery.min.js"></script>
	    <!-- Bootstrap tether Core JavaScript -->
	    <script src="../../assets/libs/popper.js/dist/umd/popper.min.js"></script>
	    <script src="../../assets/libs/bootstrap/dist/js/bootstrap.min.js"></script>
	    <!-- apps -->
	    <script src="../../dist/js/app.js"></script>
	    <script src="../../dist/js/app.init.overlay.js"></script>
	     <!-- slimscrollbar scrollbar JavaScript -->
	    <script src="../../assets/libs/perfect-scrollbar/dist/perfect-scrollbar.jquery.min.js"></script>
	    <script src="../../assets/extra-libs/sparkline/sparkline.js"></script>
	    <!--Wave Effects -->
	    <script src="../../dist/js/waves.js"></script>
	    <!--Menu sidebar -->
	    <script src="../../dist/js/sidebarmenu.js"></script>
	    <!--Custom JavaScript -->
	    <script src="../../dist/js/custom.min.js"></script>
		<script src="../../dist/js/application.js"></script>
		
		<!-- scripts-adm-common -->
		<link href="../../assets/libs/datatables.net-bs4/css/dataTables.bootstrap4.css" rel="stylesheet">
	    <link href="../../assets/libs/datatables/novo/css/responsive.bootstrap4.min.css" rel="stylesheet" type="text/css" >
	    <link href="../../assets/libs/datatables/novo/css/buttons.dataTables.min.css" rel="stylesheet" type="text/css">
	    
		<!-- data-table js -->
		<script src="../../assets/libs/datatables/novo/js/jquery.dataTables.min.js"></script>
		<script src="../../assets/libs/datatables/novo/js/dataTables.buttons.min.js"></script>
		<script src="../../assets/libs/datatables/novo/js/jszip.min.js"></script>
		<script src="../../assets/libs/datatables/novo/js/pdfmake.min.js"></script>
		<script src="../../assets/libs/datatables/novo/js/vfs_fonts.js"></script>
		<script src="../../assets/libs/datatables/novo/js/buttons.flash.min.js"></script>
		<script src="../../assets/libs/datatables/novo/js/buttons.colVis.min.js"></script>
		<script src="../../assets/libs/datatables/novo/js/buttons.print.min.js"></script>
		<script src="../../assets/libs/datatables/novo/js/buttons.html5.min.js"></script>
		<script src="../../assets/libs/datatables/novo/js/dataTables.bootstrap4.min.js"></script>
		<script src="../../assets/libs/datatables/novo/js/dataTables.responsive.min.js"></script>
	    <script src="../../assets/libs/datatables/novo/js/responsive.bootstrap4.min.js"></script>
	    
	    <!-- Select2 -->
	    <link href="../../assets/libs/select2/dist/css/select2.min.css" rel="stylesheet" type="text/css"/>
  	    <link href="../../assets/libs/select2/dist/css/select2-bootstrap.css" rel="stylesheet" type="text/css"/>
	    <script src="../../assets/libs/select2/dist/js/select2.full.min.js"></script>
    	<script src="../../assets/libs/select2/dist/js/select2.min.js"></script>    
 
 		<!-- SweetAlert -->   	
    	<link href="../../assets/libs/sweetalert2/dist/sweetalert2.min.css" rel="stylesheet"/>
    	<script src="../../assets/libs/sweetalert2/dist/sweetalert2.all.min.js"></script>
    	
 		<!-- Jquery Mask -->
    	<script src="../../assets/libs/jquery.mask/jquery.mask.min.js"></script>
    	
    	<!-- Boostrap Validator -->
    	<link href="../../assets/libs/jquery.bootstrapvalidator/0.5.2/css/bootstrapValidator.min.css"  rel="stylesheet" type="text/css"/>
		<script src="../../assets/libs/jquery.bootstrapvalidator/0.5.2/js/bootstrapValidator.min.js"></script>
    	<script src="../../assets/libs/jquery.bootstrapvalidator/0.5.2/js/language/pt_BR.js"></script>

		<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.8.4/moment.min.js"></script>
				
		<!-- This Page CSS -->
		<link rel="stylesheet" type="text/css" href="../../assets/libs/daterangepicker/daterangepicker.css"/>
		<link rel="stylesheet" type="text/css" href="../../dist/css/application-document-movement.css"/>
		<link rel="stylesheet" type="text/css" href="../../dist/css/application-currency.css"/>

		<script src="../../assets/libs/moment/moment.js"></script>
		<script src="../../assets/libs/daterangepicker/daterangepicker.js"></script>
		<script src="https://cdn.datatables.net/plug-ins/1.10.20/sorting/datetime-moment.js"></script>

		<link rel="stylesheet" type="text/css" href="../../assets/libs/bootstrap-datepicker/dist/css/bootstrap-datepicker.min.css">
		<script src="../../assets/libs/bootstrap-datepicker/dist/js/bootstrap-datepicker.min.js"></script>
		<script src="../../assets/libs/bootstrap-datepicker/dist/locales/bootstrap-datepicker.pt-BR.min.js"></script>

		<!-- Boostrap Validator -->
		<link href="../../assets/libs/jquery.bootstrapvalidator/0.5.2/css/bootstrapValidator.min.css"  rel="stylesheet" type="text/css"/>
		<script src="../../assets/libs/jquery.bootstrapvalidator/0.5.2/js/bootstrapValidator.min.js"></script>
		<script src="../../assets/libs/jquery.bootstrapvalidator/0.5.2/js/language/pt_BR.js"></script>

		<script type="text/javascript" src="https://cdn.datatables.net/plug-ins/1.10.10/sorting/datetime-moment.js"></script>	

		<!-- Css Boostrap Validator Select2 -->
		<style type="text/css">
			.was-validated .custom-select:invalid + .select2 .select2-selection{
				border-color: #f62d51!important;
				padding-right: 2.0625rem;
				background-repeat: no-repeat;
				background-position: center right calc(6.0625rem / 4);
				background-size: calc(2.0625rem / 2) calc(2.0625rem / 2);
				background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='%23f62d51' viewBox='-2 -2 7 7'%3e%3cpath stroke='%23d9534f' d='M0 0l3 3m0-3L0 3'/%3e%3ccircle r='.5'/%3e%3ccircle cx='3' r='.5'/%3e%3ccircle cy='3' r='.5'/%3e%3ccircle cx='3' cy='3' r='.5'/%3e%3c/svg%3E");
			}
			.was-validated .custom-select:valid + .select2 .select2-selection{
				border-color: #36bea6!important;
				padding-right: 3.29688rem;
				background: url(../../assets/images/custom-select.png) right .75rem center/8px 10px no-repeat,url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 8 8'%3e%3cpath fill='%2336bea6' d='M2.3 6.73L.6 4.53c-.4-1.04.46-1.4 1.1-.8l1.1 1.4 3.4-3.8c.6-.63 1.6-.27 1.2.7l-4 4.6c-.43.5-.8.4-1.1.1z'/%3e%3c/svg%3e") center right 1.75rem/1.03125rem 1.03125rem no-repeat;
			}
			*:focus{
			outline:0px;
			}
			
			.modal-body{
				height: 250px;
				overflow-y: auto;
			}
			
			@media (min-height: 500px) {
				.modal-body { height: 500px; }
			}
			
			@media (min-height: 800px) {
				.modal-body { height: 700px; }
			}
		</style>

		<script type="text/javascript">
			let initialBalance = 0;
			function createTable(){ 
				let tableReport = $('#table-relatorio').DataTable({
					destroy: true,
					select:'single',
					'paging': false,
					'displayLength': 50,
					'responsive': true,
					'order': [ [ 0, 'asc' ] ],
					'autoWidth': false,
					'scrollY': '400px',
					'scrollCollapse': true,
					'language': {
						'lengthMenu': 'Mostrar _MENU_ registro(s) por pagina',
						'zeroRecords': 'Nenhum registro encontrado',
						'info': 'Mostrando _TOTAL_ registro(s)',
						'infoEmpty': 'Nenhum registro encontrado',
						'infoFiltered': '(filtrado de um total de _MAX_ registros)',
						'search': 'Filtrar:',
						'sLengthMenu': '_MENU_ &nbsp;registro(s) por p&aacute;gina',
						"decimal": ",",
						"thousands": ".",
						'paginate': {
							'next': 'Proximo',
							'previous': 'Anterior'
							}
					},
					'footerCallback': function ( row, data, start, end, display ) {
						let totalCredit = 0;
						let totalDebit = 0;
						let totalSaldo = 0;
						let balance = initialBalance;
						
						$.each(display, function(key, value)
						{
							let valor = parseFloat(data[value].documentValueHidden);
							if(valor<0)
							{
								totalDebit += valor;
							}
							else
							{
								totalCredit += valor;	
							}	

							balance = (balance + valor);
							const idBalance = 'balance_'+data[value].documentId+'_'+data[value].documentParentId;

							if(balance>=0)
							{
								$('td#'+idBalance).html('<span class="positive-value">'+parseFloat(balance).toFixed(2)+'</span>');
							}
							else
							{
								$('td#'+idBalance).html('<span class="negative-value">'+parseFloat(balance).toFixed(2)+'</span>');
							}
						});
						totalSaldo =  (initialBalance + totalCredit +totalDebit);
						populateDataSaldo(totalCredit, totalDebit, totalSaldo);
					},
					"columns": [
						{
							"className": 'text-center',
							"data": "movementDate"
						},
						{ 
						"className": 'text-left',
						"data": "bankAccount" 
						},
						{ 
						"className": 'text-left',
						"data": "company" 
						},
						{ 
							"className": 'text-left',
							"data": "description" 
						},
						{ 
						"className": 'text-right',
						"data": "documentValue" 
						},
						{ 
						"className": 'text-right',
						"data": "documentValueHidden" 
						},
						{ 
						"className": 'text-right',
						"data": "documentParentId" 
						},
						{ 
						"className": 'text-right',
						"data": "documentId" 
						},
						{ 
						"className": 'text-right',
						"data": "documentBalance" 
						}
					],
					'columnDefs': [
						{ responsivePriority: 1, targets: 0 },
						{ responsivePriority: 1, targets: 4 },
						{ responsivePriority: 1, targets: 8 },
						{
						"targets": [5],
						"visible": false,
						"searchable": false
						},
						{
						"targets": [6],
						"visible": false,
						"searchable": false
						},
						{
						"targets": [7],
						"visible": false,
						"searchable": false
						}
					],
					dom: 'Bfrtip',
					buttons: [
					{
						extend: 'copyHtml5',
						text: 'Copiar',
						exportOptions: {
							columns: ':visible'
						}
					}, 
					{
						extend: 'excelHtml5',
						text: 'Excel',
						exportOptions: {
							columns: ':visible'
						}
					}, 
					{
						extend: 'pdfHtml5',
						text: 'PDF',
						title: 'Relatorio de Documentos',
						orientation: 'landscape',
						pageSize: 'A4',
						pageMargins: [ 0, 0, 0, 0 ], // try #1 setting margins
						margin: [ 0, 0, 0, 0 ], // try #2 setting margins
						key: { // press E for export PDF
							key: 'e',
							altKey: true
						},
						exportOptions: {
							columns: ':visible'
						}
					}, 
					{
						text: 'JSON',
						action: function(e, dt, button, config) 
						{
							var data = dt.buttons.exportData();
							$.fn.dataTable.fileSave(new Blob([JSON.stringify(data)]), 'Export.json');
						}
					},
					'colvis',
					]
				});

				let tableReportCompany = $('#table-company').DataTable({
					destroy: true,
					select:'single',
					'paging': false,
					'responsive': true,
					'order': [ [ 0, 'asc' ] ],
					'autoWidth': false,
					'scrollY': '400px',
					'scrollCollapse': true,
					'language': {
						'lengthMenu': 'Mostrar _MENU_ registro(s) por pagina',
						'zeroRecords': 'Nenhum registro encontrado',
						'info': 'Mostrando _TOTAL_ registro(s)',
						'infoEmpty': 'Nenhum registro encontrado',
						'infoFiltered': '(filtrado de um total de _MAX_ registros)',
						'search': 'Filtrar:',
						'sLengthMenu': '_MENU_ &nbsp;registro(s) por p&aacute;gina',
						"decimal": ",",
						"thousands": ".",
						'paginate': {
							'next': 'Proximo',
							'previous': 'Anterior'
							}
					},
					columnDefs: [
						{ responsivePriority: 1, targets: 0 },
						{ responsivePriority: 1, targets: 3 },
						{ responsivePriority: 2, targets: 1 },
						{ responsivePriority: 2, targets: 2 }
					],
					dom: 'Bfrtip',
					buttons: [
					{
						extend: 'copyHtml5',
						text: 'Copiar',
						exportOptions: {
							columns: ':visible'
						}
					}, 
					{
						extend: 'excelHtml5',
						text: 'Excel',
						exportOptions: {
							columns: ':visible'
						}
					}, 
					{
						extend: 'pdfHtml5',
						text: 'PDF',
						title: 'Relatorio de Documentos',
						orientation: 'landscape',
						pageSize: 'A4',
						pageMargins: [ 0, 0, 0, 0 ], // try #1 setting margins
						margin: [ 0, 0, 0, 0 ], // try #2 setting margins
						key: { // press E for export PDF
							key: 'e',
							altKey: true
						},
						exportOptions: {
							columns: ':visible'
						}
					}, 
					{
						text: 'JSON',
						action: function(e, dt, button, config) 
						{
							var data = dt.buttons.exportData();
							$.fn.dataTable.fileSave(new Blob([JSON.stringify(data)]), 'Export.json');
						}
					},
					'colvis',
					]
				});
				$('.buttons-copy, .buttons-csv, .buttons-print, .buttons-pdf, .buttons-excel, .dt-button').addClass('btn btn-primary mr-1');
			}

			function populateDataSaldo(totalCredit, totalDebit, totalSaldo)
			{
				$('h3#totalCredit').text('R$ ' + parseFloat(totalCredit).toFixed(2));
				$('h3#totalDebit').text('R$ ' + parseFloat(totalDebit).toFixed(2));
				$('h3#totalSaldo').text('R$ ' + parseFloat(totalSaldo).toFixed(2));        	
			}

			function searchBankAccountByCompany()
			{
				let companys = $('form#formFilter select#company').val(); 
				if(''==companys){
					return;
				}
				$('form#formGetBankAccounts input#personsId').val(companys);
				const form = $('form#formGetBankAccounts'); 			
				const dataForm = form.serializeArray();

				$('form#formFilter select#bankAccounts').empty().trigger('change');
				
				showLoading("Carregando Contas... Por favor aguarde...");  	

				let message = 'Ocorreu um erro ao carregar contas.';
				
				$.ajax({
					url : form.attr('action'),
					type : "POST",
					data : dataForm,
					dataType : "json"
				})
				.done(function(data, textStatus, jqXHR) 
				{	    		
					if(true==data.status)
					{
						$.each(data.itens, function(key, value)
						{
							let optionKey = value.key;
							let optionValue = value.value + ' (' + value.key + ')';

							let newOption = new Option(optionValue, optionKey, true, true);
							$('form#formFilter select#bankAccounts').append(newOption).trigger('change');	
						});
					}
					else
					{
						hideLoading();
						showSweetalertWarning('Alerta!', data.message,'5000');
					}
				})
				.fail(function(data, textStatus, jqXHR) 
				{
					if(''!=data.message)
					{
						message = data.message;
					}
					showSweetalertWarning('Alerta!', message,'5000');
				}).always(function() 
				{
					$('#block1').hide();
					$('#block2').hide();
				});
			}

			function printDocuments(){
				let companys = $('form#formFilter select#company').val(); 
				if(''==companys){
					showSweetalertWarning('Alerta!', 'Pelo menos uma empresa deve ser informada.','5000');
					return;
				}

				let bankAccounts = $('form#formFilter select#bankAccounts').val(); 
				if(''==bankAccounts){
					showSweetalertWarning('Alerta!', 'Pelo menos uma conta deve ser informada.','5000');
					return;
				}
				document.getElementById('formFilter').submit();
			}

			function searchDocuments()
			{
				let companys = $('form#formFilter select#company').val(); 
				if(''==companys){
					showSweetalertWarning('Alerta!', 'Pelo menos uma empresa deve ser informada.','5000');
					return;
				}

				let bankAccounts = $('form#formFilter select#bankAccounts').val(); 
				if(''==bankAccounts){
					showSweetalertWarning('Alerta!', 'Pelo menos uma conta deve ser informada.','5000');
					return;
				}

				const form = $('form#formFilter'); 			
				const dataForm = form.serializeArray();
				
				showLoading("Carregando documentos... Por favor aguarde...");  	

				let message = 'Ocorreu um erro ao carregar documentos.';
				
				$.ajax({
					url : $('form#formFilterReportView').attr('action'),
					type : "POST",
					data : dataForm,
					dataType : "json"
				})
				.done(function(data, textStatus, jqXHR) 
				{	    		
					if(true==data.status)
					{
						populateTable(data);
					}
					else
					{
						hideLoading();
						showSweetalertWarning('Alerta!', data.message,'5000');
					}
				})
				.fail(function(data, textStatus, jqXHR) 
				{
					if(''!=data.message)
					{
						message = data.message;
					}
					showSweetalertWarning('Alerta!', message,'5000');
				}).always(function() 
				{
					$('#block1').hide();
					$('#block2').hide();
				});
			}
	    
			function populateTable(data)
			{
				let trHTML = '<table id="table-relatorio" style="width: 100%;" class="table table-striped table-bordered display">';
				trHTML += '<thead>';
				trHTML += '<tr>';
				trHTML += '<th class="text-center">Data</th>';
				trHTML += '<th class="text-center">Conta Banc&aacute;ria</th>';
				trHTML += '<th class="text-center">Empresa</th>';
				trHTML += '<th class="text-center">Descri&ccedil;&atilde;o</th>';
				trHTML += '<th class="text-center">Lan&ccedil;.</th>';
				trHTML += '<th class="text-center">Valor Hidden</th>';
				trHTML += '<th class="text-center">Agrupamento</th>';
				trHTML += '<th class="text-center">Documento</th>';
				trHTML += '<th class="text-center">Saldo</th>';
				trHTML += '</tr>';
				trHTML += '</thead>';
				trHTML += '<tbody>';
				
				initialBalance = new Number(parseFloat(data.report.initialBankAccountAvaliable));
				$('h3#totalInitial').text('R$ ' + parseFloat(initialBalance).toFixed(2));

				let totalCredit = new Number(0);
				let totalDebit = new Number(0);
				let totalSaldo = new Number(0);
				
				$.each(data.report.itens, function(key, value)
				{
					trHTML += '<tr>';
					trHTML += '<td class="text-center">'+value.documentDate+'</td>';
					trHTML += '<td class="text-left">'+value.banAccountDescription+ '('+value.bankAccountId+')'+'</td>';
					trHTML += '<td class="text-left">'+value.companyDescription+ '('+value.companyId+')'+'</td>';
					trHTML += '<td class="text-left">'+value.documentNote+'</td>';
					if(value.documentValue>=0)
					{
						trHTML += '<td style="text-align: right"><span class="positive-value">'+parseFloat(value.documentValue).toFixed(2)+'</span></td>';
					}
					else
					{
						trHTML += '<td style="text-align: right"><span class="negative-value">'+parseFloat(value.documentValue).toFixed(2)+'</span></td>';
					}
					trHTML += '<td style="text-align: right">'+parseFloat(value.documentValue).toFixed(2)+'</td>';
					trHTML += '<td style="text-align: right">'+value.documentParentId+'</td>';
					trHTML += '<td style="text-align: right">'+value.documentId+'</td>';
					trHTML += '<td class="text-right" id="balance_'+value.documentId+'_'+value.documentParentId+'">'+value.documentValue+'</td>';
				});
				
				trHTML += '</tbody>';
				trHTML += '</table>';
				$('div#report-table').html(trHTML);

				trHTML = '<table id="table-company" style="width: 100%;" class="table table-striped table-bordered display">';
				trHTML += '<thead>';
				trHTML += '<tr>';
				trHTML += '<th class="text-center">Empresa</th>';
				trHTML += '<th class="text-center">Crédito</th>';
				trHTML += '<th class="text-center">Débito</th>';
				trHTML += '<th class="text-center">Saldo</th>';
				trHTML += '</tr>';
				trHTML += '</thead>';
				trHTML += '<tbody>';
				$.each(data.report.companys, function(key, value)
				{
					trHTML += '<tr class="bg-secondary text-white">';
					trHTML += '<td class="text-left" style="font-weight: 600;">'+value.companyDescription+' ('+value.companyId+')'+'</td>';
					trHTML += '<td class="text-right" style="font-weight: 600;">'+parseFloat(value.totalCredit).toFixed(2)+'</td>';
					trHTML += '<td class="text-right" style="font-weight: 600;">'+parseFloat(value.totalDebit).toFixed(2)+'</td>';
					trHTML += '<td class="text-right" style="font-weight: 600;">'+parseFloat(value.totalBalance).toFixed(2)+'</td>';
					trHTML += '</tr>';
					$.each(value.accounts, function(keyItem, valueItem)
					{
						trHTML += '<tr>';
						trHTML += '<td class="text-left">'+valueItem.banAccountDescription+' ('+valueItem.bankAccountId+')'+'</td>';
						trHTML += '<td class="text-right">'+parseFloat(valueItem.totalCredit).toFixed(2)+'</td>';
						trHTML += '<td class="text-right">'+parseFloat(valueItem.totalDebit).toFixed(2)+'</td>';
						trHTML += '<td class="text-right">'+parseFloat(valueItem.totalBalance).toFixed(2)+'</td>';
						trHTML += '</tr>';
					});
				});
				trHTML += '</tbody>';
				trHTML += '</table>';
				$('div#report-table-company').html(trHTML);
				createTable();
				
				//totalSaldo = (totalCredit+totalDebit);
				//populateDataSaldo(totalCredit, totalDebit, totalSaldo);
			}

			$( document ).ready(function() {
					'use strict';						
					$('.collapse').collapse('show');
						
					$.fn.dataTable.moment('DD/MM/YYYY');

					/** Force input numeric only */
					$('.force-numeric-only').ForceNumericOnly();

					$('.timeseconds').daterangepicker({
					ranges: {
					'Hoje': [moment(), moment()],
					'Ontem': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],
					'Ult. 7 Dias': [moment().subtract(6, 'days'), moment()],
					'Ult. 30 Dias': [moment().subtract(29, 'days'), moment()],
					'Este Mês': [moment().startOf('month'), moment().endOf('month')],
					'Ult. Mês': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]
					},
					autoApply: true,
					autoUpdateInput: true,
					locale: {
						format: 'DD/MM/YYYY', 
						"separator": " - ",
						"applyLabel": "Aplicar",
						"cancelLabel": "Cancelar",
						"fromLabel": "De",
						"toLabel": "Até",
						"customRangeLabel": "Custom",
						"daysOfWeek": [
							"Dom",
							"Seg",
							"Ter",
							"Qua",
							"Qui",
							"Sex",
							"Sáb"
						],
						"monthNames": [
							"Janeiro",
							"Fevereiro",
							"Março",
							"Abril",
							"Maio",
							"Junho",
							"Julho",
							"Agosto",
							"Setembro",
							"Outubro",
							"Novembro",
							"Dezembro"
						],
						"firstDay": 0
					},
					showDropdowns: true
				});

				$('form#formFilter select#company')
				.select2({ 
					width: '100%',
					theme: "bootstrap",
					language: 
					{
						noResults: function (params) 
						{
							return "Nenhum registro encontrado.";
						}
					}
				}).on('change', function (e)
				{
					searchBankAccountByCompany();
				});

				$('form#formFilter select#bankAccounts')
				.select2({ 
					width: '100%',
					theme: "bootstrap",
					language: 
					{
						noResults: function (params) 
						{
							return "Nenhum registro encontrado.";
						}
					}
				});

				$('form#formFilter select#operation')
				.select2({ 
					width: '100%',
					theme: "bootstrap",
					language: 
					{
						noResults: function (params) 
						{
							return "Nenhum registro encontrado.";
						}
					}
				});
				//searchDocuments();
				createTable();
			});
		</script>
	</body>
</html>